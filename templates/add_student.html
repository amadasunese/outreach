{% extends "base.html" %}

{% block title %}Add Student{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h1 class="text-center">Add Student</h1>
            <form method="POST" id="studentForm">
                <!-- Section 1: Personal Information -->
                <div class="form-section">
                    <h4 class="text-center">Personal Information</h4>
                    <div class="mb-3">
                        <label for="name" class="form-label">Full Name:</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>

                    <div class="mb-3">
                        <label for="sex" class="form-label">Sex:</label>
                        <select class="form-control" name="sex" id="sex" required>
                            <!-- <option value="Male">Male</option> -->
                            <option value="Female">Female</option>

                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="age" class="form-label">Age:</label>
                        <input type="number" class="form-control" id="age" name="age" required>
                    </div>

                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-primary next">Next</button>
                    </div>
                </div>

                <!-- Section 2: Program Details -->
                <div class="form-section" style="display: none;">
                    <h4 class="text-center">Program Details</h4>
                    <div class="mb-3">
                        <label for="program_type" class="form-label">Program Type:</label>
                        <select class="form-control" name="program_type" id="program_type" required>
                            <option value="">--Select Program Type--</option>
                            <option value="School Outreach">School Outreach</option>
                            <option value="Center Meeting">Center Meeting</option>
                        </select>
                    </div>

                    <div id="school_fields" style="display: none;">
                        <div class="mb-3">
                            <label for="school_id" class="form-label">School:</label>
                            <select class="form-control" name="school_id" id="school_id" required>
                                <option value="">--Select School--</option>
                                {% for school in schools %}
                                <option value="{{ school.id }}">{{ school.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="student_class" class="form-label">Class:</label>
                            <input type="text" class="form-control" id="student_class" name="student_class" required>
                        </div>

                        <div class="mb-3">
                            <label for="academic_session" class="form-label">Academic Session:</label>
                            <input type="text" class="form-control" id="academic_session" name="academic_session" required>
                        </div>

                        <div class="mb-3">
                            <label for="term" class="form-label">Term:</label>
                            <select class="form-control" name="term" id="term" required>
                                <option value="">--Select Term--</option>
                                <option value="First">First Term</option>
                                <option value="Second">Second Term</option>
                                <option value="Third">Third Term</option>
                            </select>
                        </div>
                    </div>

                    <div id="center_fields" style="display: none;">
                        <div class="mb-3">
                            <label for="center_year" class="form-label">Center Year:</label>
                            <select class="form-control" name="center_year" id="center_year" required>
                                <option value="">--Select Year--</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="center_class" class="form-label">Center Class:</label>
                            <select class="form-control" name="center_class" id="center_class" required>
                                <option value="">--Select Class--</option>
                                <option value="Pearl">Pearl</option>
                                <option value="Diamond">Diamond</option>
                                <option value="Oasis">Oasis</option>
                            </select>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-secondary prev">Previous</button>
                        <button type="button" class="btn btn-primary next">Next</button>
                    </div>
                </div>

                <!-- Section 3: Contact Information -->
                <div class="form-section" style="display: none;">
                    <h4 class="text-center">Contact Information</h4>
                    <div class="mb-3">
                        <label for="address" class="form-label">Address:</label>
                        <input type="text" class="form-control" id="address" name="address" required>
                    </div>

                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone:</label>
                        <input type="text" class="form-control" id="phone" name="phone" required>
                    </div>

                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-secondary prev">Previous</button>
                        <button type="button" class="btn btn-primary next">Next</button>
                    </div>
                </div>

                <!-- Section 4: Parental Information -->
                <div class="form-section" style="display: none;">
                    <h4 class="text-center">Parental Information</h4>
                    <div class="mb-3">
                        <label for="father_name" class="form-label">Father's Name:</label>
                        <input type="text" class="form-control" id="father_name" name="father_name" required>
                    </div>

                    <div class="mb-3">
                        <label for="father_occupation" class="form-label">Father's Occupation:</label>
                        <input type="text" class="form-control" id="father_occupation" name="father_occupation" required>
                    </div>

                    <div class="mb-3">
                        <label for="father_phone" class="form-label">Father's Phone:</label>
                        <input type="text" class="form-control" id="father_phone" name="father_phone" required>
                    </div>

                    <div class="mb-3">
                        <label for="mother_name" class="form-label">Mother's Name:</label>
                        <input type="text" class="form-control" id="mother_name" name="mother_name" required>
                    </div>

                    <div class="mb-3">
                        <label for="mother_occupation" class="form-label">Mother's Occupation:</label>
                        <input type="text" class="form-control" id="mother_occupation" name="mother_occupation" required>
                    </div>

                    <div class="mb-3">
                        <label for="mother_phone" class="form-label">Mother's Phone:</label>
                        <input type="text" class="form-control" id="mother_phone" name="mother_phone" required>
                    </div>

                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-secondary prev">Previous</button>
                        <button type="button" class="btn btn-primary next">Next</button>
                    </div>
                </div>

                <!-- Section 5: Final Details -->
                <div class="form-section" style="display: none;">
                    <h4 class="text-center">Additional Information</h4>
                    <div class="mb-3">
                        <label for="introduced_by" class="form-label">Who Introduced You to GPI?</label>
                        <input type="text" class="form-control" id="introduced_by" name="introduced_by">
                    </div>

                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="is_graduating" name="is_graduating">
                        <label for="is_graduating" class="form-check-label">Graduating?</label>
                    </div>

                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="consent" name="consent" required>
                        <label for="consent" class="form-check-label">Consent</label>
                    </div>

                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-secondary prev">Previous</button>
                        <input type="submit" class="btn btn-success" value="Submit">
                    </div>
                </div>
            </form>

            <a href="{{ url_for('auth.students') }}" class="btn btn-link mt-3">Back to Students</a>

        </div>
    </div>
</div>

<!-- JavaScript for Form Navigation -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let currentSection = 0;
        const sections = document.querySelectorAll(".form-section");
        const nextButtons = document.querySelectorAll(".next");
        const prevButtons = document.querySelectorAll(".prev");

        function showSection(index) {
            sections.forEach((section, i) => {
                section.style.display = i === index ? "block" : "none";
            });
        }

        nextButtons.forEach(button => {
            button.addEventListener("click", () => {
                if (currentSection < sections.length - 1) {
                    currentSection++;
                    showSection(currentSection);
                }
            });
        });

        prevButtons.forEach(button => {
            button.addEventListener("click", () => {
                if (currentSection > 0) {
                    currentSection--;
                    showSection(currentSection);
                }
            });
        });

        showSection(currentSection);
    });

    const programTypeSelect = document.getElementById('program_type');
    const schoolFields = document.getElementById('school_fields');
    const centerFields = document.getElementById('center_fields');

    programTypeSelect.addEventListener('change', () => {
        schoolFields.style.display = programTypeSelect.value === 'School Outreach' ? 'block' : 'none';
        centerFields.style.display = programTypeSelect.value === 'Center Meeting' ? 'block' : 'none';
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let currentSection = 0;
        const sections = document.querySelectorAll(".form-section");
        const nextButtons = document.querySelectorAll(".next");
        const prevButtons = document.querySelectorAll(".prev");
        const form = document.getElementById("studentForm");

        function showSection(index) {
            sections.forEach((section, i) => {
                section.style.display = i === index ? "block" : "none";
            });
        }

        function validateSection(index) {
            const inputs = sections[index].querySelectorAll("input, select");
            for (let input of inputs) {
                if (input.hasAttribute("required") && !input.value.trim()) {
                    alert(`Please complete all required fields before proceeding.`);
                    return false;
                }
            }
            return true;
        }

        nextButtons.forEach(button => {
            button.addEventListener("click", () => {
                if (validateSection(currentSection) && currentSection < sections.length - 1) {
                    currentSection++;
                    showSection(currentSection);
                }
            });
        });

        prevButtons.forEach(button => {
            button.addEventListener("click", () => {
                if (currentSection > 0) {
                    currentSection--;
                    showSection(currentSection);
                }
            });
        });

        form.addEventListener("submit", function (event) {
            for (let i = 0; i < sections.length; i++) {
                if (!validateSection(i)) {
                    event.preventDefault();
                    return;
                }
            }
        });

        showSection(currentSection);
    });

    // const programTypeSelect = document.getElementById('program_type');
    // const schoolFields = document.getElementById('school_fields');
    // const centerFields = document.getElementById('center_fields');

    programTypeSelect.addEventListener('change', () => {
        schoolFields.style.display = programTypeSelect.value === 'School Outreach' ? 'block' : 'none';
        centerFields.style.display = programTypeSelect.value === 'Center Meeting' ? 'block' : 'none';

        // Set required fields dynamically based on selection
        document.querySelectorAll('#school_fields input, #school_fields select').forEach(el => {
            el.required = programTypeSelect.value === 'School Outreach';
        });

        document.querySelectorAll('#center_fields input, #center_fields select').forEach(el => {
            el.required = programTypeSelect.value === 'Center Meeting';
        });
    });
</script>


{% endblock %}
